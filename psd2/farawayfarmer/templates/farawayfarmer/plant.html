{% extends "base.html" %} 

{% block content %}
{% load static %}

<div class="app-container">
    <main class="flex-container">
        <div class="plant-image-container">
            <img class="plant-image" src="{% static 'farawayfarmer/hydroponic_plant.png' %}" alt="Plant Image">
        </div>
        <div class="info-and-actions">
            <div class="plant-info">
                <h2>Plant Name/ID: {{ plant.name }}</h2>
                <p><strong>Floor:</strong> {{ plant.floor }}</p>
                <p><strong>Public:</strong> {{ plant.public|yesno:"Yes,No" }}</p>
                <p><strong>Water Level:</strong> Minimum {{ plant.min_water_level }}ml, Amount to Water {{ plant.amt_to_water }}ml</p>
                <div class="plant-maintenance-info">
                    <p><strong>Last watered:</strong> {{ plant.last_watered|date:"F j, Y, P" }}</p>
                    <p><strong>Last fertilized:</strong> {{ plant.last_fertilized|date:"F j, Y, P" }}</p>
                </div>
                <p><strong>Automatic Watering System Enabled:</strong> {{ plant.auto_system|yesno:"Yes,No" }}</p>
            </div>
            
            <div class="action-buttons">
                <button class="btn" id="water-btn" data-id="{{ plant.plant_id }}">
                    <img src="{% static 'farawayfarmer/watering_can_icon.webp' %}" alt="Water" class="button-icon">
                    Water
                </button>
                <button class="btn" id="fertilize-btn">
                    <img src="{% static 'farawayfarmer/fertilizer_icon.webp' %}" alt="Fertilize" class="button-icon">
                    Fertilize
                </button>
                <button class="btn" id="on-off-btn">
                    <img src="{% static 'farawayfarmer/on_off_icon.png' %}" alt="On-Off" class="button-icon">
                    On/Off
                </button>
            </div>
        </div>
    </main>
</div>

<div id="modal" class="modal">
    <div class="modal-content">
        <span class="close-button">&times;</span>
        <h2>Set Water Level and Amount</h2>
        <form id="water-level-form">
            <div class="form-row">
                <label for="min-water-level">Current minimum water level: 50ml</label>
                <input type="number" id="min-water-level" name="min-water-level" placeholder="Enter new minimum water level" aria-describedby="minWaterLevelHelp">
            </div>
            <div class="form-row">
                <label for="amount-to-water">Amount to water:</label>
                <input type="number" id="amount-to-water" name="amount-to-water" placeholder="Enter amount to water" aria-describedby="amountToWaterHelp">
            </div>
            <div class="form-row">
                <button type="submit" class="confirm-button">Confirm</button>
            </div>
        </form>
    </div>
</div>


<script>
    // Logic for watering the plant
    document.getElementById('water-btn').addEventListener('click', function() {
        var plantId = this.getAttribute('data-id'); // Get individual ID from button data attribute
        // Make AJAX call to Django view
        var xhr = new XMLHttpRequest();
        xhr.open("POST", "http://localhost:8001/plants/call_water_plant/", true);
        xhr.setRequestHeader("Content-Type", "application/json");
        xhr.onreadystatechange = function() {
            if (xhr.readyState === 4 && xhr.status === 200) {
                console.log("Watering successful");
                // Handle success response
            } else {
                console.error("Failed to water plant:", xhr.responseText);
                // Handle error response
            }
        };
        var data = JSON.stringify({"plant.plant_id": plantId}); // Send individual ID in JSON format
        xhr.send(data);

    });

    // Logic for fertilizing the plant
    document.getElementById('fertilize-btn').addEventListener('click', function() {
        // Add fertilizing logic here
    });

    // Modal logic
    var modal = document.getElementById('modal');
    var btn = document.getElementById('on-off-btn'); // Button that opens the modal
    var span = document.getElementsByClassName('close-button')[0]; // The close button inside the modal

    // Function to toggle the display of the modal
    function toggleModal() {
        modal.style.display = (modal.style.display === "block" ? "none" : "block");
    }

    // Button click to open or close the modal
    btn.addEventListener('click', toggleModal);

    // Close button click
    span.addEventListener('click', toggleModal);

    // Click outside the modal to close it
    window.addEventListener('click', function(event) {
        if (event.target == modal) {
            toggleModal();
        }
    });

    // Handle the form submission
    document.getElementById('water-level-form').addEventListener('submit', function(event) {
        event.preventDefault();
        // Add logic here to handle the updated water level input
        toggleModal(); // Close the modal after form submission
    });
</script>


<style>
    body, html {
        margin: 0;
        padding: 0;
        font-family: 'Arial', sans-serif;
    }
    .app-container {
        text-align: center;
        height: 100vh; /* This sets the container's height to fill the entire viewport height */
        display: flex;
        flex-direction: column; /* Stacks main along the vertical axis */
    }

    .flex-container {
        display: flex;
        flex-direction: row; /* Children laid out in a row */
        height: 100%; /* Flex-container fills the app-container height */
    }
    
    .plant-image-container, .info-and-actions {
        flex: 1; /* Each takes up half the space */
        display: flex;
        flex-direction: column; /* Content organized in columns */
        padding: 10px;
        height: 80%; /* Full height of their parent container */
    }
    
    .plant-info {
        background-color: #eeffd1;
        border-radius: 15px;
        padding: 20px;
        text-align: left;
        display: flex;
        flex-direction: column;
        justify-content: space-around; /* Evenly distributes the space around the items */
        flex: 1; /* Flex grow */
    }
    
    .action-buttons {
        display: flex;
        justify-content: space-between;
        padding: 0;
        width: 100%;
    }
    
    .info-and-actions {
        display: flex;
        flex-direction: column;
        justify-content: space-between; /* Align items to top and bottom */
        flex: 1; /* Flex grow */
    }
    
    .plant-maintenance-info {
        font-size: 0.9em; /* Smaller text for maintenance info */
        color: #666; /* Darker grey text */
        margin-top: 10px; /* Adds space above maintenance info */
    }

    .btn {
        background-color: #8BC34A; /* Button background color */
        border-radius: 20px; /* Rounded corners */
        padding: 10px 20px; /* Button padding */
        border: none; /* Removes border */
        color: white; /* Text color */
        font-size: 1em; /* Text size */
        margin: 5px; /* Space between buttons */
        display: flex;
        flex-direction: column; /* Stack icon and text */
        align-items: center;
        justify-content: center;
        box-shadow: 0px 4px 8px rgba(0, 0, 0, 0.2); /* Soft shadow for buttons */
        flex: 1;
    }
    .btn:hover {
        background-color: #9CCC65; /* Lighter green on hover */
    }
    .button-icon {
        margin-bottom: 5px; /* Space between icon and text */
        width: 30px; /* Icon size */
        height: auto; /* Maintain aspect ratio */
    }

    .modal {
        display: none;
        position: fixed;
        z-index: 1000; /* Increased z-index for higher priority */
        left: 0;
        top: 0;
        width: 100%;
        height: 100%;
        background-color: rgba(0, 0, 0, 0.5); /* Soften the overlay */
    }
    
    .modal-content {
        background-color: #ffffff;
        margin: 5% auto; /* Reduced to bring the modal up slightly */
        padding: 40px; /* Increased padding for better spacing */
        border-radius: 8px; /* Rounded corners */
        box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1); /* Soft shadow for depth */
        width: 50%; /* Adjusted for a balanced width */
        max-width: 500px; /* Maximum width to maintain form factor */
    }
    
    .close-button {
        color: #aaaaaa;
        float: right;
        font-size: 24px;
        font-weight: bold;
        border: none; /* Remove border */
        background: none; /* Transparent background */
    }
    
    .close-button:hover,
    .close-button:focus {
        color: #333333;
        cursor: pointer;
    }
    
    .form-row label,
    .form-row input {
        display: block;
        width: 100%; /* Ensure full width within container */
        margin-bottom: 10px; /* Adjusted spacing */
    }
    
    .form-row input {
        padding: 10px; /* Better input field spacing */
        border: 1px solid #cccccc; /* Subtle border */
        border-radius: 4px; /* Rounded corners for input fields */
    }
    
    .confirm-button {
        background-color: #4CAF50;
        color: white;
        padding: 12px 24px;
        text-align: center;
        display: block; /* Change to block for full-width button */
        width: 100%; /* Full-width button */
        margin: 20px 0 0; /* Adjusted margin for spacing */
        border-radius: 4px; /* Consistent rounded corners */
        font-weight: 500; /* Medium font weight */
    }
    
</style>
{% endblock %}
